<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="js/jquery.cookie.min.js"></script>
    <script>
        function preview(row) {
            var $row = $("li:nth-child(" + (row + 1) + ")");
            if($row.hasClass("open")) {
                $row.find("img").remove();
                $row.removeClass("open");
            } else {
                var prev = $row.text();
                $row.append("<img src='" + prev.replace("http://mv.ssttevee.com/", "thumb/") + "'/>");
                $row.addClass("open");
            }
        }

        function logout() {
            $.cookie("k", null, { path: '/', expires: -1 });
            location.reload();
        }

        var parseData = function(data) {
            data = data.split("\n");

            var $list = $("<ul></ul>");

            $("body").html($list);
            $list.append("<li>Uploads:<a href='javascript:logout();'>logout</a><a href='javascript:prompt(\"Your API Key\", $.cookie(\"k\"));'>apikey</a></li>");

            for(var i = 1; i < data.length - 1; i++) {
                var info = data[i].split(",");
                $list.append("<li><a href=\"" + info[2] + "\" onclick=\"javascript:preview(" + i + "); return false;\" class=\"left\">" + info[2] + "</a><a href='javascript:deleteFile(" + info[0] + ");' class='delete'></a><br></li>");
            }
        };

        function login() {
            $.ajax({
                url: "api/auth",
                type: "post",
                data: {
                    e: $("input[name=e]").val(),
                    p: $("input[name=p]").val(),
                    z: "poop"
                }
            }).done(function( data ) {
                console.log(data);
                if(data.indexOf("no") >= 0 || data.indexOf("bad") >= 0) {
                    alert("login failed");
                } else {
                    data = data.split(",");
                    $.cookie("k", data[1], { path: '/', expires: Date.now() + 60*60*24*30 });
                    location.reload();
                }
            });
        }

        function deleteFile(imageId) {
            $.ajax({
                url: "api/del",
                type: "post",
                data: {
                    k: $.cookie("k"),
                    i: imageId
                }
            }).done(parseData);
        }

        function loadData() {
            if($.cookie("k")) {
                $.ajax({
                    url: "api/hist",
                    type: "post",
                    data: {
                        k: $.cookie("k"),
                        limit: 0
                    }
                }).done(parseData);
            }
        }

        $(function() {
            loadData();
        });
    </script>
    <style>
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        li {
            padding: 5px 10px;
        }
        li:not(:first-child) {
            padding: 5px 10px 5px 17px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJAQMAAADaX5RTAAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAAcnJyURAOlQAAAAF0Uk5TAEDm2GYAAAAYSURBVAjXY6hnYGhoYOgAo30wBlCkngEAcaMIXb/SfJ8AAAAASUVORK5CYII=);
            background-position: 10px 10px;
        }
        li.open {
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJAQMAAADaX5RTAAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAAcnJyURAOlQAAAAF0Uk5TAEDm2GYAAAAVSURBVAjXY6hnYGhogKJ9DQh2PQMAb+MIPQm7FX4AAAAASUVORK5CYII=);
        }
        li:nth-child(even) {
            background-color: #eee;
        }
        a.delete:after {
            content: "delete";
        }
        a {
            float: right;
            padding-left: 10px;
        }
        a.left {
            float: left;
        }
    </style>
</head>
<body>
    Login: <br/>
    <form onsubmit="login();return false;">
        Email: <input type="text" name="e" /><br/>
        Password: <input type="password" name="p" /><br/>
        <input type="submit" />
    </form>
</body>
</html>